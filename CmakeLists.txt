cmake_minimum_required (VERSION 3.0.0)

option (DEBUG "DEBUG" OFF)

set_property(GLOBAL PROPERTY USE_FOLDERS ON)

set(CMAKE_CXX_STANDARD 11)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

if (EMSCRIPTEN)
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11")
    set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -O3")
else (EMSCRIPTEN)
    set(USE_CLANG true)
    if (USE_CLANG)
        set(CMAKE_GENERATOR_TOOLSET "clangcl")
    endif (USE_CLANG)
endif (EMSCRIPTEN)

project (Carve)

if (EMSCRIPTEN)
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -O3")
    set(CMAKE_EXECUTABLE_SUFFIX ".bc")
    set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -s EXPORT_ALL=1")
else (EMSCRIPTEN)
    # Enable enhanced instruction set:      Advanced Vector Extensions 2 (/arch:AVX2)
    # Enable intrinsic functions:           Yes (/Oi)
    # Favor size or speed:                  Favor fast code (/Ot)
    # Inline function expansion:            Any Suitable (/Ob2)
    set(CARVE_RELEASE_COMPILER_FLAGS   "/arch:AVX2 /Oi /Ot /Ob2")
    set(CMAKE_CXX_FLAGS_RELWITHDEBINFO "${CMAKE_CXX_FLAGS_RELWITHDEBINFO} ${CARVE_RELEASE_COMPILER_FLAGS}")
    set(CMAKE_CXX_FLAGS_RELEASE        "${CMAKE_CXX_FLAGS_RELEASE} ${CARVE_RELEASE_COMPILER_FLAGS}")
endif (EMSCRIPTEN)

set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/bin)
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/bin/)

#if (WIN32)
#    add_definitions(-MP -D_CRT_SECURE_NO_WARNINGS -D_CRT_SECURE_NO_DEPRECATE -D_SCL_SECURE_NO_WARNINGS -DNOMINMAX)
#endif (WIN32)

add_subdirectory(libcarve)
add_subdirectory(carve)

if (NOT EMSCRIPTEN)
    add_subdirectory(carve_run)
endif (NOT EMSCRIPTEN)
